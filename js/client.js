var googleUser={},serverURL="",serverProtocol="http://agario.loc"===window.origin?"http":"https",maxWeight=0,sec=0,food_eaten=0,top_leaderboard_position=1e3;let uData={};if("sigmally.com"===location.hostname||"beta.sigmally.com"===location.hostname)var googleClientID="1063846395656-tkpcrm37hfklkkq7sf7o3vran20qm0ji.apps.googleusercontent.com";else if("fr-agario.com"==location.hostname){googleClientID="792427553623-5vqc913odjjdgoq5mmg8lehtqiutg8kg.apps.googleusercontent.com";document.getElementById("gamemode").innerHTML+='<option id="option_3" value="fr-agario.com/ws/">test</option>',document.getElementById("gamemode").innerHTML+='<option id="option_4" value="u2.fr-agario.com/ws/">test2</option>'}let captchaVerified=!1;const recaptchaV2SiteKey="6Lck1wsmAAAAACmj_46s4DLFaLoFwJCXkzh6HEaM",recaptchaV3SiteKey="6LeqgRYdAAAAABO1HoCmpDhZRhqATZTwT6wKZjE_",gScript=document.createElement("script");gScript.src=`https://www.google.com/recaptcha/api.js?render=${recaptchaV3SiteKey}`,gScript.async=!0,document.head.appendChild(gScript);const virusImages=[],players={};let oldImage,oldName,backgroundImage=null;!function(){"use strict";"undefined"!=typeof WebSocket&&"undefined"!=typeof DataView&&"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array||(alert("Your browser does not support required features, please update your browser or get a new one."),window.stop());const e={" ":17,w:21,q:18,e:22,r:23,t:24,p:25};for(let e=0;e<5;++e)(virusImages[e]=new Image).src=window.origin+`/assets/images/viruses/${e}.png`;function t(e){return document.getElementById(e)}function n(e,t,n){this.src=e,this.volume="number"==typeof t?t:.5,this.maximum="number"==typeof n?n:1/0,this.elms=[]}(backgroundImage=new Image).src=window.origin+"/assets/images/bg.png",n.prototype.play=function(e){var t;"number"==typeof e&&(this.volume=e);for(var n=0;n<this.elms.length;n++){var i=this.elms[n];if(i.paused){t=i;break}}t||(t=this.add()),t.volume=this.volume,t.play()},n.prototype.add=function(){if(this.elms.length>=this.maximum)return this.elms[0];var e=new Audio(this.src);return this.elms.push(e),e};var i,s=Date.now();function o(e,t,n){return"#"+(1<<24|e<<16|t<<8|n).toString(16).slice(1)}function a(e){var t=function(e){var t=e.slice(1);if(3===t.length&&(t=t.split("").map((function(e){return e+e}))),6!==t.length)throw new Error("invalid color "+e);var n=parseInt(t,16);return{r:n>>>16&255,g:n>>>8&255,b:255&n}}(e);return o(.9*t.r,.9*t.g,.9*t.b)}function r(e){for(var t in e)delete e[t]}Array.prototype.remove=function(e){var t=this.indexOf(e);return-1!==t&&this.splice(t,1),-1!==t},Element.prototype.hide=function(){this.style.display="none",1==this.style.opacity&&(this.style.opacity=0)},Element.prototype.show=function(e){this.style.display="";var t=this;e&&(this.style.transition="opacity "+e+"s ease 0s",setTimeout((function(){t.style.opacity=1}),20))},Array.prototype.includes||(Array.prototype.includes=function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return!0;return!1}),(i=CanvasRenderingContext2D.prototype).resetTransform||(i.resetTransform=function(){this.setTransform(1,0,0,1,0,0)});var l=new DataView(new ArrayBuffer(8));function c(e){return this._e=e,this.reset(),this}function h(e,t,n){this._e=n,e&&this.repurpose(e,t)}c.prototype={writer:!0,reset:function(e){this._b=[],this._o=0},setUint8:function(e){return e>=0&&e<256&&this._b.push(e),this},setInt8:function(e){return e>=-128&&e<128&&this._b.push(e),this},setUint16:function(e){return l.setUint16(0,e,this._e),this._move(2),this},setInt16:function(e){return l.setInt16(0,e,this._e),this._move(2),this},setUint32:function(e){return l.setUint32(0,e,this._e),this._move(4),this},setInt32:function(e){return l.setInt32(0,e,this._e),this._move(4),this},setFloat32:function(e){return l.setFloat32(0,e,this._e),this._move(4),this},setFloat64:function(e){return l.setFloat64(0,e,this._e),this._move(8),this},_move:function(e){for(var t=0;t<e;t++)this._b.push(l.getUint8(t))},setStringUTF8:function(e){for(var t=unescape(encodeURIComponent(e)),n=0,i=t.length;n<i;n++)this._b.push(t.charCodeAt(n));return this._b.push(0),this},build:function(){return new Uint8Array(this._b)}},h.prototype={reader:!0,repurpose:function(e,t){this.view=e,this._o=t||0},getUint8:function(){return this.view.getUint8(this._o++,this._e)},getInt8:function(){return this.view.getInt8(this._o++,this._e)},getUint16:function(){return this.view.getUint16((this._o+=2)-2,this._e)},getInt16:function(){return this.view.getInt16((this._o+=2)-2,this._e)},getUint32:function(){return this.view.getUint32((this._o+=4)-4,this._e)},getInt32:function(){return this.view.getInt32((this._o+=4)-4,this._e)},getFloat32:function(){return this.view.getFloat32((this._o+=4)-4,this._e)},getFloat64:function(){return this.view.getFloat64((this._o+=8)-8,this._e)},getStringUTF8:function(e=!0){for(var t,n="";0!==(t=this.view.getUint8(this._o++));)n+=String.fromCharCode(t);return e?decodeURIComponent(escape(n)):n},raw:function(e=0){const t=this.view.buffer.slice(this._o,this._o+e);return this._o+=e,t}};var d={verbosity:2,error:function(){d.verbosity>0&&console.error.apply(null,arguments)},warn:function(){d.verbosity>1&&console.warn.apply(null,arguments)},info:function(){d.verbosity>2&&console.info.apply(null,arguments)},debug:function(){d.verbosity>3&&console.debug.apply(null,arguments)}};const u="SIG 0.0.1",g=new Uint8Array(256),m=new Uint8Array(256);let p=null,f="https:"==window.location.protocol,y="An unnamed cell",v=2*Math.PI,w={spacebar:" ",esc:"escape"},b={Space:" ",KeyW:"w",KeyQ:"q",KeyE:"e",KeyR:"r",KeyT:"t",KeyP:"p"};function x(){C&&(d.debug("ws cleanup trigger"),C.onopen=null,C.onmessage=null,C.close(),C=null)}let S=!1;function k(){S=!1,D=1e3,t("connecting").hide(),t("needtobeloggined").hide();const e=new c;e.setStringUTF8(u),L(e),getTopUsers()}function T(e){d.warn(e)}function _(e){e.currentTarget==C&&(d.debug("ws disconnected "+e.code+" '"+e.reason+"'"),x(),U(),setTimeout((function(){setserver(p)}),D*=1.5))}function L(e){C&&1===C.readyState&&(e.build?C.send(e.build()):C.send(e))}function I(e){P=Date.now();const t=new h(new DataView(e.data),0,!0);if(!S){if(t.getStringUTF8(!1)!==u)return C.close();g.set(new Uint8Array(t.raw(256)));for(const e in g)m[g[e]]=~~e;return void(S=!0)}const n=t.getUint8();switch(m[n]){case 16:{let e,n,s,a,r,l,c,h,d,u,g,m,p,f,y;m=t.getUint16();for(let i=0;i<m;i++){e=t.getUint32(),n=t.getUint32();const i=M.byId[e],s=M.byId[n];settings.playSounds&&M.mine.includes(e)&&(s.isPellet?te:ee).play(parseFloat(H.value)),M.mine.includes(e)&&s&&s.isPellet&&food_eaten++,s.destroy(i?e:null)}for(;s=t.getUint32(),0!==s;)a=t.getInt16(),r=t.getInt16(),l=t.getUint16(),c=t.getUint8(),d=!!(2&c),g=!!(4&c),u=!!(8&c),p=d?o(t.getUint8(),t.getUint8(),t.getUint8()):null,y=g?t.getStringUTF8():null,f=u?t.getStringUTF8():null,M.byId.hasOwnProperty(s)?(h=M.byId[s],h.update(P),h.updated=P,h.ox=h.x,h.oy=h.y,h.os=h.s,h.nx=a,h.ny=r,h.ns=l,p&&h.setColor(p),f&&h.setName(f),y&&h.setSkin(y)):(h=new pe(s,a,r,l,f,p,y,c),M.byId[s]=h,M.list.push(h));for(m=t.getUint16(),i=0;i<m;i++)n=t.getUint32(),M.byId.hasOwnProperty(n)&&!M.byId[n].destroyed&&M.byId[n].destroy(null);break}case 17:X.target.x=t.getFloat32(),X.target.y=t.getFloat32(),X.target.scale=t.getFloat32(),X.target.scale*=X.viewportScale,X.target.scale*=X.userZoom;break;case 18:for(var i in M.byId)M.byId[i].destroy(null);case 20:M.mine=[];break;case 21:d.warn("got packet 0x15 (draw line) which is unsupported");break;case 32:M.mine.push(t.getUint32());break;case 48:{E.items=[],E.type="text";const e=t.getUint32();for(i=0;i<e;++i)E.items.push(t.getStringUTF8());ue();break}case 49:{E.items=[],E.type="ffa";const e=t.getUint32();for(i=0;i<e;++i){const e=!!t.getUint32(),n=t.getStringUTF8(),i=t.getUint32();E.items.push({me:e,myposition:i,name:pe.prototype.parseName(n).name||y})}ue();break}case 64:if($.left=t.getFloat64(),$.top=t.getFloat64(),$.right=t.getFloat64(),$.bottom=t.getFloat64(),$.width=$.right-$.left,$.height=$.bottom-$.top,$.centerX=($.left+$.right)/2,$.centerY=($.top+$.bottom)/2,33===e.data.byteLength)break;J||(J=!0,X.x=X.target.x=$.centerX,X.y=X.target.y=$.centerY,X.scale=X.target.scale=1),t.getUint32(),F.pingLoopId=setInterval((function(){L(g.slice(254,255)),F.pingLoopStamp=Date.now()}),2e3);break;case 99:{const e=t.getUint8(),n=o(t.getUint8(),t.getUint8(),t.getUint8());let i=t.getStringUTF8();i=pe.prototype.parseName(i).name||y;const s=t.getStringUTF8(),a=!!(128&e),r=!!(64&e),l=!!(32&e);a&&"SERVER"!==i&&(i="[SERVER] "+i),r&&(i="[ADMIN] "+i),l&&(i="[MOD] "+i);const c=Math.max(3e3,1e3+150*s.length);A.waitUntil=P-A.waitUntil>1e3?P+c:A.waitUntil+c,A.messages.push({server:a,admin:r,mod:l,color:n,name:i,message:s,time:P}),settings.showChat&&he();break}case 254:F.info=JSON.parse(t.getStringUTF8()),F.latency=P-F.pingLoopStamp,function(){if(!F.info)return F.visible=!1;F.visible=!0;var e=F.canvas,t=e.getContext("2d");t.font="14px Ubuntu";for(var n=[F.info.name+" ("+F.info.mode+")",F.info.playersTotal+" / "+F.info.playersLimit+" players",F.info.playersAlive+" playing",F.info.playersSpect+" spectating",(2.5*F.info.update).toFixed(1)+"% load @ "+de(F.info.uptime)],i=0,s=0;s<n.length;s++)i=Math.max(i,2+t.measureText(n[s]).width+2);e.width=i,e.height=16*n.length,t.font="14px Ubuntu",t.fillStyle=settings.darkTheme?"#AAA":"#555",t.textBaseline="top";for(s=0;s<n.length;s++)t.fillText(n[s],2,16*s-1)}();break;default:x()}}function U(){r(M),r($),r(E),r(A),r(F),A.messages=[],B.show(),E.items=[],M.mine=[],M.byId={},M.list=[],X.x=X.y=X.target.x=X.target.y=0,X.scale=X.target.scale=1,J=!1}window.settings={nick:"",skin:"",gamemode:"",showSkins:!0,showNames:!0,darkTheme:!0,showColor:!0,showMass:!1,_showChat:!0,get showChat(){return this._showChat},set showChat(e){const n=t("chat_block");e?n.show():n.hide(),this._showChat=e},showMinimap:!0,showPosition:!1,showBorder:!1,showGrid:!0,playSounds:!1,soundsVolume:.5,moreZoom:!1,fillSkin:!0,backgroundSectors:!1,jellyPhysics:!0};const M=Object.create({mine:[],byId:{},list:[]}),$=Object.create({left:-2e3,right:2e3,top:-2e3,bottom:2e3,width:4e3,height:4e3,centerX:-1,centerY:-1}),E=Object.create({type:NaN,items:null,canvas:document.createElement("canvas"),teams:["#F33","#3F3","#33F"]}),A=Object.create({messages:[],waitUntil:0,canvas:document.createElement("canvas"),visible:!1});window.__devfunc={chat:{fillChatWithRandomMessages:function(e){for(var t=0;t<e;t++)A.messages.push({server:!1,admin:!1,mod:!1,color:"#1088ff",name:"[test chat]",message:Math.floor(1e7*Math.random()).toString(36),time:Date.now()});he()},sendMessage:function(e){A.messages.push({server:!1,admin:!1,mod:!1,color:"#1088ff",name:"[test chat]",message:e+"",time:Date.now()}),he()},clearChat:function(){A.messages=[],B.show(),he()}}};var H,B={chtblock:null,vsblBtn:null,thumb:null,track:null,contentShiftY:0,chatLeftOffset:0,chatBlockHeight:182,wrapperHeight:0,_percent:0,visability:!0,_alpha:1,init:function(){return this.chtblock=document.getElementById("chat_block"),this.vsblBtn=document.getElementById("chat_vsbltyBtn"),this.track=document.getElementById("chat_scrollbar"),this.thumb=document.getElementById("chat_thumb"),!!(this.chtblock&&this.vsblBtn&&this.track&&this.thumb)&&(this.thumb.addEventListener("pointerdown",this.pDown.bind(this)),this.vsblBtn.addEventListener("click",this.visabilatyChange.bind(this)),this.inited=!0,!0)},visabilatyChange:function(){this.visability?(this.chtblock.classList.add("chatblock--opacity"),this._alpha=.2,this.visability=!1):(this.chtblock.classList.remove("chatblock--opacity"),this._alpha=1,this.visability=!0)},show:function(){this.wrapperHeight=this.chatBlockHeight/X.viewportScale,this.inited&&A.canvas.height>this.wrapperHeight&&A.messages.length?(this.track.classList.add("chatblock__scrollbar--active"),this.chatLeftOffset=27,this._updateScrollBar()):(this.track.classList.remove("chatblock__scrollbar--active"),this.thumb.style.bottom="0px",this.chatLeftOffset=0,this.contentShiftY=0)},pDown:function(e){e.preventDefault();var t=this,n=e.clientY,i=0;function s(e){e.preventDefault();var s=e.clientY,o=i-(s-n),a=t.track.clientHeight-t.thumb.offsetHeight;o>=0&&o<=a?(t.thumb.style.bottom=o+"px",t.shiftContent(100*o/a)):o>=0?(t.thumb.style.bottom=a+"px",t.shiftContent(100)):(t.thumb.style.bottom="0px",t.shiftContent(0))}t.thumb.style.bottom?i=+t.thumb.style.bottom.slice(0,-2):t.thumb.style.bottom="0px",document.addEventListener("pointermove",s),document.addEventListener("pointerup",(function e(t){document.removeEventListener("pointermove",s),document.removeEventListener("pointerup",e)}))},shiftContent:function(e){this._percent=e;var t=this.wrapperHeight,n=A.canvas.height;this.contentShiftY=e*(t-n)/100},wrapTheChat:function(e){var t=document.createElement("canvas"),n=t.getContext("2d");return t.height=this.wrapperHeight,t.width=A.canvas.width,n.globalAlpha=this._alpha,n.drawImage(A.canvas,0,t.height-A.canvas.height-this.contentShiftY),t},_mslngth:0,_updateScrollBar:function(){if(this._mslngth!=A.messages.length){this._mslngth=A.messages.length;var e=this.track.clientHeight*this.wrapperHeight/A.canvas.height;this.thumb.style.height=e>=20?e+"px":"20px";var t=this.track.clientHeight-this.thumb.offsetHeight,n=t/100,i=this.wrapperHeight-A.canvas.height,s=100*this.contentShiftY/i;this.thumb.style.bottom=s*n>=0&&s*n<=t?s*n+"px":s*n>=0?t+"px":"0px"}},destroy:function(){}},F=Object.create({fps:0,latency:NaN,supports:null,info:null,pingLoopId:NaN,pingLoopStamp:null,canvas:document.createElement("canvas"),visible:!1,score:NaN,maxScore:0}),C=null,D=1e3,P=Date.now(),N=Date.now(),q=null,O=null,R={};const j=new Map;var W,V,z=!1,G=!1,Y=null,J=!1,X={x:0,y:0,target:{x:0,y:0,scale:1},viewportScale:1,userZoom:1,sizeScale:1,scale:1},Z=NaN,K=NaN,Q={" ":!1,w:!1,e:!1,r:!1,t:!1,p:!1,q:!1,enter:!1,escape:!1},ee=new n("https://sigmally.com/assets/sound/eat.mp3",.5,10),te=new n("https://sigmally.com/assets/sound/pellet.mp3",.5,10);function ne(){z=!1,t("overlays").hide(),t("menu-wrapper").hide(),t("left-menu").hide(),t("menu-links").hide(),t("right-menu").hide(),t("left_ad_block").hide(),t("ad_bottom").hide()}function ie(){z=!0,t("overlays").show(.5),t("menu-wrapper").show(),t("left-menu").show(),t("menu-links").show(),t("right-menu").show(),t("left_ad_block").show(),t("ad_bottom").show()}function se(e){e.translate(q.width/2,q.height/2),oe(e),e.translate(-X.x,-X.y)}function oe(e){e.scale(X.scale,X.scale)}function ae(e){e.translate(X.x,X.y),function(e){e.scale(1/X.scale,1/X.scale)}(e),e.translate(-q.width/2,-q.height/2)}function re(e,t){function n(e,t,n){""!==settings[e]&&(t[n]=settings[e]),t.addEventListener("change",(function(){requestAnimationFrame((function(){settings[e]=t[n]}))}))}switch(t.tagName.toLowerCase()){case"input":switch(t.type.toLowerCase()){case"range":case"text":n(e,t,"value");break;case"checkbox":n(e,t,"checked")}break;case"select":n(e,t,"value")}}function le(){localStorage.setItem("settings",JSON.stringify(settings))}function ce(e,t,n,i){for(;;){const s=e.measureText(t),o=Math.abs(s.actualBoundingBoxLeft)+Math.abs(s.actualBoundingBoxRight),a=Math.abs(s.actualBoundingBoxDescent)+Math.abs(s.actualBoundingBoxAscent);if(o<n&&a<i)break;t=t.slice(0,-1)}return t}!function(e,t,n,i){n||(n="GET");i||(i="text");var s=new XMLHttpRequest;s.onload=function(){t(this.response)},s.open(n,e),s.responseType=i,s.send()}("https://sigmally.com/skinList.txt",(function(e){var n=e.split(",").filter((e=>e.length>0));if(0!=n.length){var i=t("gallery-btn");i&&(i.style.display="inline-block");for(var s=Date.now(),o=0;o<n.length;o++)R[n[o]]=s;for(var o in R)R[o]!==s&&delete R[o]}})),window.addEventListener("resize",(()=>{document.querySelector("body");"http"===serverProtocol&&console.log(window.innerWidth)}));const he=()=>{if(0===A.messages.length&&settings.showChat)return A.visible=!1;A.messages.length>100&&(A.messages=A.messages.slice(A.messages.length-100)),A.visible=!0;const e=A.canvas,t=e.getContext("2d"),n=A.messages,i=[],s=n.length;for(const e of n){const n=ce(t,e.name,150,30)||y,s=ce(t,e.message,400,30).trim();s&&i.push([{text:n,color:e.color},{text:" "+s,color:settings.darkTheme?"#FFF":"#000"}])}let o=0;const a=20*s+8;for(const e of i){let n=0;for(const i of e)t.font="18px Ubuntu",i.width=t.measureText(i.text).width,n+=i.width;o=Math.max(n,o)}e.width=o,e.height=a;for(let e=0;e<i.length;e++){const n=i[e];let s=0;for(const i of n)t.font="18px Ubuntu",t.fillStyle=i.color,t.fillText(i.text,s,20*(1+e)),s+=i.width}B.show()};function de(e){var t=~~((e=~~e)/60);if(t<1)return"<1 min";var n=~~(t/60);if(n<1)return t+"min";var i=~~(n/24);return i<1?n+"h":i+"d"}function ue(){if(NaN===E.type)return E.visible=!1;if(!settings.showNames||0===E.items.length)return E.visible=!1;E.visible=!0;var e=E.canvas,t=e.getContext("2d"),n=E.items.length;e.width=200;var i=n+1;if(e.height="pie"!==E.type?60+24*i:240,t.globalAlpha=.4,t.fillStyle="#000",t.fillRect(0,0,200,e.height),t.globalAlpha=1,t.fillStyle="#FFF",t.font="30px Ubuntu",t.fillText("Leaderboard",100-t.measureText("Leaderboard").width/2,40),"pie"===E.type)for(var s=0,o=0;o<n;o++)t.fillStyle=E.teams[o],t.beginPath(),t.moveTo(100,140),t.arc(100,140,80,s,s+=E.items[o]*v,!1),t.closePath(),t.fill();else{var a,r,l=!1;if(t.font="20px Ubuntu",0!=parseInt(E.items[0].myposition)&&parseInt(E.items[0].myposition)<top_leaderboard_position&&(top_leaderboard_position=parseInt(E.items[0].myposition)),E.items[0].myposition>=10){for(o=0;o<n-1;o++){"text"===E.type?a=E.items[o]:(a=E.items[o].name,l=E.items[o].me),t.fillStyle=l?"#FAA":"#FFF","ffa"===E.type&&(a=o+1+". "+a);var c=(r=t.measureText(a).width)>200?2:100-.5*r;t.fillText(a,c,70+24*o)}if(0!=E.items[0].myposition){t.fillStyle="#FAA";var h=E.items[0].myposition+". "+settings.nick||host;c=(r=t.measureText(h).width)>200?2:100-.5*r;t.fillText(h,c,70+24*(n-1))}}else for(o=0;o<n;o++){"text"===E.type?a=E.items[o]:(a=E.items[o].name,l=E.items[o].me),t.fillStyle=l?"#FAA":"#FFF","ffa"===E.type&&(a=o+1+". "+a);c=(r=t.measureText(a).width)>200?2:100-.5*r;t.fillText(a,c,70+24*o)}}}function ge(){F.fps+=(1e3/Math.max(Date.now()-N,1)-F.fps)/10,N=Date.now();for(var e=M.list.slice(0).sort(me),t=0,n=e.length;t<n;t++)e[t].update(N);if(function(){for(var e=[],t=0;t<M.mine.length;t++)M.byId.hasOwnProperty(M.mine[t])&&e.push(M.byId[M.mine[t]]);if(e.length>0){for(var n=0,i=0,s=0,o=0,a=(t=0,e.length);t<a;t++){var r=e[t];o+=~~(r.ns*r.ns/100),n+=r.x,i+=r.y,s+=r.s}X.target.x=n/a,X.target.y=i/a,X.sizeScale=Math.pow(Math.min(64/s,1),.4),X.target.scale=X.sizeScale,X.target.scale*=X.viewportScale*X.userZoom,X.x=(X.target.x+X.x)/2,X.y=(X.target.y+X.y)/2,F.score=o,o>maxWeight&&(maxWeight=o),F.maxScore=Math.max(F.maxScore,o)}else F.score=NaN,F.maxScore=0,X.x+=(X.target.x-X.x)/20,X.y+=(X.target.y-X.y)/20;X.scale+=(X.target.scale-X.scale)/9}(),settings.jellyPhysics){!function(){var e=1920/X.sizeScale,t=1080/X.sizeScale,n=X.x-e/2,i=X.y-t/2;V=new PointQuadTree(n,i,e,t,32);for(var s=0;s<M.list.length;++s)for(var o=M.list[s],a=0;a<o.points.length;++a)V.insert(o.points[a])}();for(t=0,n=e.length;t<n;++t){var i=e[t];i.updateNumPoints(),i.movePoints()}}O.save(),O.fillStyle=settings.darkTheme?"#111":"#F2FBFF",O.fillRect(0,0,q.width,q.height),settings.showGrid&&function(){O.save(),O.lineWidth=1,O.strokeStyle=settings.darkTheme?"#AAA":"#000",O.globalAlpha=.2;var e,t=q.width/X.scale,n=q.height/X.scale,i=(-X.x+t/2)%50,s=(-X.y+n/2)%50;for(oe(O),O.beginPath(),e=i;e<t;e+=50)O.moveTo(e,0),O.lineTo(e,n);for(e=s;e<n;e+=50)O.moveTo(0,e),O.lineTo(t,e);O.stroke(),O.restore()}(),settings.backgroundSectors&&function(){if(void 0!==$&&void 0!==$.width){O.save();var e=["ABCDE","12345"],t=$.width/5,n=$.height/5;se(O),O.fillStyle=settings.darkTheme?"#666":"#DDD",O.textBaseline="middle",O.textAlign="center",O.font=(t/3|0)+"px Ubuntu";for(var i=0;i<5;++i)for(var s=0;s<5;++s){var o=e[0][s]+e[1][i],a=(s+.5)*t+$.left,r=(i+.5)*n+$.top;O.fillText(o,a,r)}O.restore()}}(),se(O),settings.showBorder&&(O.strokeStyle="#0000ff",O.lineWidth=20,O.lineCap="round",O.lineJoin="round",O.beginPath(),O.moveTo($.left,$.top),O.lineTo($.right,$.top),O.lineTo($.right,$.bottom),O.lineTo($.left,$.bottom),O.closePath(),O.stroke());for(t=0,n=e.length;t<n;t++)e[t].draw(O);ae(O),V=null,O.scale(X.viewportScale,X.viewportScale);var s=2;O.fillStyle=settings.darkTheme?"#FFF":"#000",O.textBaseline="top",isNaN(F.score)||(O.font="30px Ubuntu",O.fillText("Score: "+F.score,2,s),s+=30),O.font="20px Ubuntu";var o=~~F.fps+" FPS";isNaN(F.latency)||(o+=" "+F.latency+"ms ping"),O.fillText(o,2,s),s+=24,F.visible&&O.drawImage(F.canvas,2,s),E.visible&&O.drawImage(E.canvas,q.width/X.viewportScale-10-E.canvas.width,10),settings.showChat&&A.visible&&(O.drawImage(B.wrapTheChat(A.canvas),(10+B.chatLeftOffset)/X.viewportScale,(q.height-54)/X.viewportScale-B.wrapperHeight),O.globalAlpha=1),function(){if(0===$.centerX&&0===$.centerY&&settings.showMinimap){O.save(),O.resetTransform();var e=$.width/$.height,t=200*e*X.viewportScale,n=200/e*X.viewportScale,i=q.width-t,s=q.height-n;O.fillStyle="#000",O.globalAlpha=.4,O.fillRect(i,s,t,n),O.globalAlpha=1;var o=["ABCDE","12345"],a=t/5,r=n/5,l=Math.min(a,r)/3;O.fillStyle=settings.darkTheme?"#666":"#DDD",O.textBaseline="middle",O.textAlign="center",O.font=l+"px Ubuntu";for(var c=0;c<5;c++)for(var h=(c+.5)*a,d=0;d<5;d++){var u=(d+.5)*r;O.fillText(o[0][c]+o[1][d],i+h,s+u)}var g=t/$.width,m=n/$.height,p=$.width/2,f=$.height/2,w=i+(X.x+p)*g,b=s+(X.y+f)*m,x=i+((w-i)/a|0)*a,S=s+((b-s)/r|0)*r;if(O.fillStyle="yellow",O.globalAlpha=.3,O.fillRect(x,S,a,r),O.globalAlpha=1,O.beginPath(),M.mine.length){for(c=0;c<M.mine.length;c++)if(T=M.byId[M.mine[c]]){O.fillStyle=T.color,h=i+(T.x+p)*g,u=s+(T.y+f)*m;var k=Math.max(T.s,200)*(g+m)/2;O.moveTo(h+k,u),O.arc(h,u,k,0,v)}}else O.fillStyle="#FAA",O.arc(w,b,5,0,v);O.fill();for(var T=null,_=(c=0,M.mine.length);c<_;c++)if(M.byId.hasOwnProperty(M.mine[c])){T=M.byId[M.mine[c]];break}if(null!==T){O.fillStyle=settings.darkTheme?"#DDD":"#222";var L=l;O.font=L+"px Ubuntu",O.fillText(T.name||y,w,b-7-L/2)}O.restore()}}(),function(){if(0===$.centerX&&0===$.centerY&&settings.showPosition){var e=$.width/$.height*200,t=$.height/$.width*40,n=q.width/X.viewportScale-e,i=q.height/X.viewportScale-t;settings.showMinimap?(O.font="15px Ubuntu",n+=e/2-1,i-=194*$.height/$.width,O.textAlign="right",O.fillStyle=settings.darkTheme?"#AAA":"#555",O.fillText("X: "+~~X.x+", Y: "+~~X.y,n+e/2,i+t/2)):(O.fillStyle="#000",O.globalAlpha=.4,O.fillRect(n,i,e,t),O.globalAlpha=1,we(O,n+e/2,i+t/2,"X: "+~~X.x+", Y: "+~~X.y))}}(),O.restore(),function(){for(var e in fe){for(var t in fe[e])N-fe[e][t].accessTime>=5e3&&delete fe[e][t];fe[e]==={}&&delete fe[e]}for(var e in ye)N-ye[e].accessTime>=5e3&&delete ye[e]}(),window.requestAnimationFrame(ge)}function me(e,t){return e.s===t.s?e.id-t.id:e.s-t.s}function pe(e,t,n,i,s,o,a,r){this.id=e,this.x=this.nx=this.ox=t,this.y=this.ny=this.oy=n,this.s=this.ns=this.os=i,this.ejected=!!(32&r),this.setColor(o),this.setName(s),this.setSkin(a),this.isJagged=1&r||16&r,this.isPellet=i<=20,this.isJagged&&(this.image=virusImages[2]),this.born=P,this.points=[],this.pointsVel=[]}pe.prototype={destroyed:!1,id:0,diedBy:0,ox:0,x:0,nx:0,oy:0,y:0,ny:0,os:0,s:0,ns:0,nameSize:0,drawNameSize:0,color:"#FFF",sColor:"#E5E5E5",skin:null,jagged:!1,isPellet:!1,born:null,updated:null,dead:null,destroy:function(e){delete M.byId[this.id],M.mine.remove(this.id)&&0===M.mine.length&&(uData.token&&getUserData(),function(e,t,n,i){document.getElementById("highest_mass").innerHTML=e;var s=Math.floor(t/3600),o=Math.floor(t%3600/60),a=Math.floor(t%3600%60),r=s>0?s+" h ":"",l=o>0?o+" m ":"",c=a>0?a+" s":"";document.getElementById("time_alive").innerHTML=r+" "+l+" "+c,document.getElementById("food_eaten").innerHTML=n,document.getElementById("top_leaderboard_position").innerHTML=i,z=!0,__line2.classList.remove("line--hidden"),googletag.cmd.push((function(){googletag.display(adSlot4)})),googletag.cmd.push((function(){googletag.display(adSlot5)})),googletag.cmd.push((function(){googletag.display(adSlot6)}))}(maxWeight,sec,food_eaten,top_leaderboard_position),maxWeight=0),this.destroyed=!0,this.dead=P,e&&!this.diedBy&&(this.diedBy=e,this.updated=P)},update:function(e){var t=(e-this.updated)/120;t=Math.max(Math.min(t,1),0),this.destroyed&&(this.isJagged||Date.now()>this.dead+200)?M.list.remove(this):this.diedBy&&M.byId.hasOwnProperty(this.diedBy)&&(this.nx=M.byId[this.diedBy].x,this.ny=M.byId[this.diedBy].y),this.x=this.ox+(this.nx-this.ox)*t,this.y=this.oy+(this.ny-this.oy)*t,this.s=this.os+(this.ns-this.os)*t,this.nameSize=3*~~(~~Math.max(~~(.3*this.ns),24)/3),this.drawNameSize=3*~~(~~Math.max(~~(.3*this.s),24)/3)},updateNumPoints:function(){var e=this.s*X.scale|0;for(e=Math.max(e,5),e=Math.min(e,120);this.points.length>e;){var t=Math.random()*this.points.length|0;this.points.splice(t,1),this.pointsVel.splice(t,1)}for(0==this.points.length&&0!=e&&(this.points.push({x:this.x,y:this.y,rl:this.s,parent:this}),this.pointsVel.push(Math.random()-.5));this.points.length<e;){t=Math.random()*this.points.length|0;var n=this.points[t],i=this.pointsVel[t];this.points.splice(t,0,{x:n.x,y:n.y,rl:n.rl,parent:this}),this.pointsVel.splice(t,0,i)}},movePoints:function(){for(var e=this.pointsVel.slice(),t=this.points.length,n=0;n<t;++n){var i=e[(n-1+t)%t],s=e[(n+1)%t],o=.7*(this.pointsVel[n]+Math.random()-.5);o=Math.max(Math.min(o,10),-10),this.pointsVel[n]=(i+s+8*o)/10}for(n=0;n<t;++n){var a=this.points[n],r=a.rl,l=this.points[(n-1+t)%t].rl,c=this.points[(n+1)%t].rl,h=this,d=V.some({x:a.x-5,y:a.y-5,w:10,h:10},(function(e){return e.parent!=h&&(n=a,((t=e).x-n.x)*(t.x-n.x)+(t.y-n.y)*(t.y-n.y)<=25);var t,n}));!d&&(a.x<$.left||a.y<$.top||a.x>$.right||a.y>$.bottom)&&(d=!0),d&&(this.pointsVel[n]=Math.min(this.pointsVel[n],0),this.pointsVel[n]-=1),r+=this.pointsVel[n],r=(9*(r=Math.max(r,0))+this.s)/10,a.rl=(l+c+8*r)/10;var u=2*Math.PI*n/t,g=a.rl;a.x=this.x+Math.cos(u)*g,a.y=this.y+Math.sin(u)*g}},parseName:function(e){var t=/^(?:\{([^}]*)\})?([^]*)/.exec(e=e||"");return{name:t[2].trim(),skin:(t[1]||"").trim()}},setName:function(e){if(null===e||this.isPellet||this.ejected)return;const t=pe.prototype.parseName(e);O.font="20px Ubuntu",this.name=ce(O,t.name,250,30)||y,this.setSkin(t.skin)},setSkin:function(e){if(e){if(this.skin=e,j.has(this.skin))return;const t=new Image;j.set(this.skin,t);const n=e.replace(/^1\%/,"/free/").replace(/^2\%/,"/level/").replace(/^3\%/,"/premium/")+".png";t.src=`${serverProtocol}://${serverURL}/skin/${n}`}},setColor:function(e){e?(this.color=e,this.sColor=a(e)):d.warn("got no color")},draw:function(e){e.save(),this.drawShape(e),this.drawText(e),e.restore()},drawShape:function(e){this.destroyed?e.globalAlpha=Math.max(120-Date.now()+this.dead,0)/120:e.globalAlpha=Math.min(Date.now()-this.born,120)/120;const t=2*this.s,n=this.s/2;if(this.isJagged)return void e.drawImage(this.image,this.x-n,this.y-n,t,t);if(e.fillStyle=settings.showColor?this.color:pe.prototype.color,e.strokeStyle=settings.showColor?this.sColor:pe.prototype.sColor,e.lineWidth=Math.max(~~(this.s/50),10),this.isPellet||(this.s-=e.lineWidth/2),e.beginPath(),settings.jellyPhysics&&this.points.length){var i=this.points[0];e.moveTo(i.x,i.y);for(var s=0;s<this.points.length;++s){i=this.points[s];e.lineTo(i.x,i.y)}}else this.isJagged||e.arc(this.x,this.y,this.s,0,v,!1);e.closePath();const o=j.get(this.skin);settings.showSkins&&this.skin&&o&&o.complete&&o.width&&o.height?(settings.fillSkin&&e.fill(),e.save(),e.clip(),e.drawImage(o,this.x-this.s,this.y-this.s,t,t),e.restore()):e.fill(),this.isPellet||(e.stroke(),this.s+=e.lineWidth/2)},drawText:function(e){if(!this.isPellet&&!this.isJagged){var t=this.y;if(this.name&&settings.showNames&&(ke(e,!1,this.x,this.y,this.nameSize,this.drawNameSize,this.name),t+=Math.max(this.s/4.5,this.nameSize/1.5)),settings.showMass&&(-1!==M.mine.indexOf(this.id)||0===M.mine.length)){var n=(~~(this.s*this.s/100)).toString();ke(e,!0,this.x,t,this.nameSize/2,this.drawNameSize/2,n)}}}};var fe={},ye={};function ve(e,t,n,i){t.font=i+"px Ubuntu",t.lineWidth=Math.max(~~(i/10),2),e.width=t.measureText(n).width+2*t.lineWidth,e.height=4*i,t.font=i+"px Ubuntu",t.lineWidth=Math.max(~~(i/10),2),t.textBaseline="middle",t.textAlign="center",t.fillStyle="#FFF",t.strokeStyle="#000",t.translate(e.width/2,2*i),1!==t.lineWidth&&t.strokeText(n,0,0),t.fillText(n,0,0)}function we(e,t,n,i,s){e.font=s+"px Ubuntu",e.textBaseline="middle",e.textAlign="center",e.lineWidth=Math.max(~~(s/10),2),e.fillStyle="#FFF",e.strokeStyle="#000",1!==e.lineWidth&&e.strokeText(i,t,n),e.fillText(i,t,n),e.restore()}function be(e,t){var n=document.createElement("canvas"),i=n.getContext("2d");return ve(n,i,e,t),fe[e]=fe[e]||{},fe[e][t]={width:n.width,height:n.height,canvas:n,value:e,size:t,accessTime:N},fe[e][t]}function xe(e,t,n){return e-n<=t&&t<=e+n}function Se(e){for(var t=Object.keys(ye),n=0,i=t.length;n<i;n++)if(xe(e,t[n],e/4))return ye[t[n]];return function(e){var t={0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{}};for(var n in t){var i=t[n].canvas=document.createElement("canvas"),s=i.getContext("2d");ve(i,s,n,e),t[n].canvas=i,t[n].width=i.width,t[n].height=i.height}return ye[e]={canvases:t,size:e,lineWidth:Math.max(~~(e/10),2),accessTime:N},ye[e]}(e)}function ke(e,t,n,i,s,o,a){if(e.save(),s>500)return we(e,n,i,a,o);if(e.imageSmoothingQuality="high",t){(u=Se(s)).accessTime=N;for(var r=u.canvases,l=o/u.size,c=0,h=0;h<a.length;h++)c+=r[a[h]].width-2*u.lineWidth;e.scale(l,l),n/=l,i/=l,n-=c/2;for(h=0;h<a.length;h++){var d=r[a[h]];e.drawImage(d.canvas,n,i-d.height/2),n+=d.width-2*u.lineWidth}}else{var u;(u=function(e,t){if(!fe[e])return be(e,t);for(var n=Object.keys(fe[e]),i=0,s=n.length;i<s;i++)if(xe(t,n[i],t/4))return fe[e][n[i]];return be(e,t)}(a,s)).accessTime=N;var g=u.canvas;l=o/u.size;e.scale(l,l),n/=l,i/=l,e.drawImage(g,n-g.width/2,i-g.height/2)}e.restore()}function Te(e){var t;return t=b[e.code]?b[e.code]:e.key.toLowerCase(),w.hasOwnProperty(t)&&(t=w[t]),t}function _e(t){var n=Te(t);if(!Q[n])if(Q.hasOwnProperty(n)&&(Q[n]=!0),"enter"==n){if(z||!settings.showChat)return;if(G){Y.blur();var i=Y.value;i.length>0&&function(e){const t=new c;t.setUint8(g[99]),t.setUint8(0),t.setStringUTF8(e),L(t)}(i),Y.value=""}else Y.focus()}else if("escape"==n)z?ne():ie();else{if(G||z)return;const t=e[n];void 0!==t&&L(g.slice(t,t+1)),"w"===n&&(W=setInterval((()=>{L(g.slice(t,t+1))}),142.85714285714286))}}function Le(e){var t=Te(e);Q.hasOwnProperty(t)&&(Q[t]=!1),"w"===t&&clearInterval(W)}function Ie(e){e.target===q&&(X.userZoom*=e.deltaY>0?.8:1.2,X.userZoom=Math.max(X.userZoom,settings.moreZoom?.1:1),X.userZoom=Math.min(X.userZoom,4))}let Ue=null;window.setserver=function(e){captchaVerified=!1;const n=players["u0.sigmally.com"];"u0.sigmally.com/ws/"===e&&n&&n.players_current>=n.players_max&&(e="u2.sigmally.com/ws/"),serverURL=(serverURL=-1!==(serverURL="http"===serverProtocol?e.replace(":8081/ws/","/server"):e.replace("/ws/","/server")).indexOf("localhost")?serverURL.replace("localhost/server","localhost:3003/server"):serverURL).replace("beta.sigmally.com:8081","beta.sigmally.com:3001"),e==p&&C&&C.readyState<=WebSocket.OPEN||(U(),function(e){C&&(d.debug("ws init on existing conn"),x()),t("connecting").show(1),p=e,(C=new WebSocket("ws"+(f?"s":"")+"://"+e)).binaryType="arraybuffer",C.onopen=k,C.onmessage=I,C.onerror=T,C.onclose=_}(e))},window.changeSkin=function(e,n){settings.skin=e.replace(/^\/skin\//,"").replace(/^free\//,"1%").replace(/^level\//,"2%").replace(/^premium\//,"3%").replace(".png","");var i=t("avatar");i&&(i.src=`${serverProtocol}://${serverURL}${e}`);var s=t("js-skin-select-icon"),o=t("js-skin-select-icon-text");s&&(s.style.backgroundImage=`url("${serverProtocol}://${serverURL}${e}")`),o&&(o.style.opacity="0");let a={};a.skin=n,a.changeSkin=1,updateUserData(uData.token,a,(()=>{t("gallery").hide()}))},window.openSkinsList=function(){void 0!==uData.id?(""==t("gallery-body").innerHTML&&drawGallery(),t("gallery").show(.5)):t("needtobeloggined").show(1)},window.addEventListener("DOMContentLoaded",(function(){q=document.getElementById("canvas"),O=q.getContext("2d"),Ue=O.createPattern(backgroundImage,"repeat"),Y=t("chat_textbox"),H=t("soundsVolume"),q.focus(),function(){var e=localStorage.getItem("settings"),n=e?JSON.parse(e):settings;for(var i in settings){var s=t("_"===i.charAt(0)?i.slice(1):i);s?(n.hasOwnProperty(i)&&(settings[i]=n[i]),re(i,s)):d.info("setting "+i+" not loaded because there is no element for it.")}}(),window.addEventListener("beforeunload",le),document.addEventListener("wheel",Ie,{passive:!0}),t("continue_button").addEventListener("click",(function(){ie(),z=!1,__line2.classList.add("line--hidden"),googletag.cmd.push((function(){googletag.pubads().refresh()}))}));let e=null;const n=t("play-btn");function i(){sec++}n.addEventListener("click",(async function(){const s=window.location.host,o={name:settings.nick,skin:settings.skin,token:uData.token};if(!captchaVerified){const i=await grecaptcha.execute(recaptchaV3SiteKey),s="localhost"===window.location.hostname?"localhost:3003/server":serverURL;let a="";if((await fetch(`${serverProtocol}://${s}/recaptcha/v3`,{method:"POST",body:JSON.stringify({recaptchaV3Token:i}),headers:{"Content-Type":"application/json"}}).then((e=>e.json())).catch(console.error)).body.success)o.recaptchaV3Token=i;else{const i=document.createElement("div");i.id="g-recaptcha",n.parentNode.insertBefore(i,n.nextSibling),n.disabled=!0,a=await new Promise((n=>{e=grecaptcha.render("g-recaptcha",{sitekey:recaptchaV2SiteKey,callback:i=>(grecaptcha.reset(e),t("g-recaptcha").remove(),t("play-btn").disabled=!1,n(i))})})),o.recaptchaV2Token=a}captchaVerified=!0}!function(e){const t=new c(!0);t.setUint8(g[0]),t.setStringUTF8(e),L(t)}(JSON.stringify(o)||s),maxWeight=0,ne(),sec=0,food_eaten=0,setInterval(i,1e3)})),window.onkeydown=_e,window.onkeyup=Le,Y.onblur=function(){G=!1,he()},Y.onfocus=function(){G=!0,he()},B.init(),q.onmousemove=function(e){Z=e.clientX,K=e.clientY},setInterval((function(){!function(e,t){const n=new c(!0);n.setUint8(g[16]),n.setUint32(e),n.setUint32(t),n._b.push(0,0,0,0),L(n)}((Z-q.width/2)/X.scale+X.x,(K-q.height/2)/X.scale+X.y)}),40),window.onresize=function(){var e=q.width=window.innerWidth,t=q.height=window.innerHeight;X.viewportScale=Math.max(e/1920,t/1080)},window.onresize();var o=t("mobileStuff"),a=(t("touchpad"),t("touchCircle")),r=!1,l=function(e){var t=e.touches[0],n=.2*innerWidth,i=.2*innerHeight;t.pageX<n&&t.pageY>innerHeight-i?(Z=innerWidth/2+(t.pageX-n/2)*innerWidth/n,K=innerHeight/2+(t.pageY-(innerHeight-i/2))*innerHeight/i):(Z=t.pageX,K=t.pageY);var s=.02*innerWidth;a.style.left=Z-s+"px",a.style.top=K-s+"px"};window.addEventListener("touchmove",l),window.addEventListener("touchstart",(function(e){r||(r=!0,o.show()),"splitBtn"==e.target.id?L(g.slice(17,18)):"ejectBtn"==e.target.id?L(g.slice(21,22)):l(e),a.show()})),window.addEventListener("touchend",(function(e){0===e.touches.length&&a.hide()})),U(),ie();var h,u=window.location.search;u&&(h=/ip=([\w\W]+:[0-9]+)/.exec(u.slice(1)))?window.setserver(h[1]):window.setserver(t("gamemode").value),window.requestAnimationFrame(ge),d.info("init done in "+(Date.now()-s)+"ms")})),function(){let e;window.showHide=function(t,n){const i=document.getElementById(n),s=document.getElementById(t);"Hide"!==s.textContent&&(e=s.textContent),i&&("none"===i.style.display?(i.style.display="",s.textContent="Hide"):(s.textContent=e,i.style.display="none"))}}(),function(){let e;window.showHideFromMaxHeight=function(t){const n=document.getElementById(t);"none"!==n.style.maxHeight&&(e=n.style.maxHeight),n&&("none"===n.style.maxHeight?(n.style.maxHeight=e,n.classList.remove("shown")):(n.style.maxHeight="none",n.classList.add("shown")))}}()}();var startApp=function(e){gapi.load("auth2",(function(){authInstance=new Promise((e=>{e(gapi.auth2.init({client_id:googleClientID,cookiepolicy:"single_host_origin",prompt:"select_account"}))})),authInstance.then((t=>{t.isSignedIn.get()&&(googleUser=t.currentUser.get(),onSignedInGoogle(t.currentUser.get())),attachSigninGoogle(e,t)}))}))};function attachSigninGoogle(e,t){t.attachClickHandler(e,{},(function(e){onSignedInGoogle(e)}),(function(e){"http"===serverProtocol&&JSON.stringify(e,void 0,2)}))}function onSignedInGoogle(e){document.querySelector("#signInBtn").classList.add("hide"),document.querySelector("#signOutBtn").classList.remove("hide"),auth(drawGallery)}function auth(e=(()=>{})){fetch(`${serverProtocol}://${serverURL}/auth`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({google_access_token:gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().id_token})}).then((e=>e.json())).then((t=>{if(console.log("auth",t.body),"success"===t.result){uData=t.body.user,uData.id=t.body.user._id;const n=document.querySelector(".profile-image");oldImage=n.innerHTML,n.innerHTML=`<img class="profile-image-icon" src="${uData.imageURL}">`;document.querySelector(".profile-image-icon").classList.add("no-click");const i=document.querySelector(".profile-name");oldName=i.innerHTML,i.innerHTML=uData.givenName;document.querySelector("#user-level").innerHTML=t.body.user.level||0;document.querySelector("#progress-next").innerText=`${t.body.user.exp}/${t.body.user.nextLevel}`;document.querySelector("#user-line-progress").setAttribute("style",`width:${t.body.user.progress||0}%`);const s=document.querySelectorAll(".coins-value");for(let e=0;s[e];e++)s[e].innerHTML=t.body.user.gold;e()}})).catch((e=>{console.error("ERROR: Server not responsed.",e)}))}function getUserData(e=(()=>{})){fetch(`${serverProtocol}://${serverURL}/userdata/${uData.token}`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}}).then((e=>e.json())).then((t=>{if("success"===t.result){uData=t.body.user,uData.id=t.body.user._id;const n=document.querySelector(".profile-image");oldImage=n.innerHTML,n.innerHTML=`<img class="profile-image-icon" src="${uData.imageURL}">`;document.querySelector(".profile-image-icon").classList.add("no-click");const i=document.querySelector(".profile-name");oldName=i.innerHTML,i.innerHTML=uData.givenName;document.querySelector("#user-level").innerHTML=t.body.user.level||0;document.querySelector("#progress-next").innerText=`${t.body.user.exp}/${t.body.user.nextLevel}`;document.querySelector("#user-line-progress").setAttribute("style",`width:${t.body.user.progress||0}%`);const s=document.querySelectorAll(".coins-value");for(let e=0;s[e];e++)s[e].innerHTML=t.body.user.gold;e()}})).catch((e=>{console.error("ERROR: Server not responsed.",e)}))}function updateUserData(e,t={},n=(()=>{})){var i={token:e,data:t};fetch(`${serverProtocol}://${serverURL}/save-user`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(i)}).then((e=>e.json())).then((e=>{if("success"===e.result){uData=e.body.user,uData.id=e.body.user._id;const t=document.querySelector(".profile-image");oldImage=t.innerHTML,t.innerHTML=`<img class="profile-image-icon" src="${uData.imageURL}">`;document.querySelector(".profile-image-icon").classList.add("no-click");const i=document.querySelector(".profile-name");oldName=i.innerHTML,i.innerHTML=uData.givenName;document.querySelector("#user-level").innerHTML=e.body.user.level||0;document.querySelector("#progress-next").innerText=`${e.body.user.exp}/${e.body.user.nextLevel}`;document.querySelector("#user-line-progress").setAttribute("style",`width:${e.body.user.progress||0}%`);const s=document.querySelectorAll(".coins-value");for(let t=0;s[t];t++)s[t].innerHTML=e.body.user.gold;n()}})).catch((e=>{console.error("ERROR: Server not responsed.",e)}))}function signOut(){uData={};const e=gapi.auth2.getAuthInstance();e.signOut().then((function(){document.querySelector(".profile-image-icon").classList.remove("no-click");document.querySelector("#signInBtn").classList.remove("hide");document.querySelector("#signOutBtn").classList.add("hide");document.querySelector(".profile-image").innerHTML=oldImage;document.querySelector(".profile-name").innerHTML=oldName;document.querySelector("#user-level").innerHTML="0";document.querySelector("#progress-next").innerText="0/0 XP";document.querySelector("#user-line-progress").setAttribute("style","width:0");const e=document.querySelectorAll(".coins-value");for(let t=0;e[t];t++)e[t].innerHTML=0;var t=document.getElementById("avatar");t&&(t.src="");var n=document.getElementById("js-skin-select-icon"),i=document.getElementById("js-skin-select-icon-text");n&&(n.style.backgroundImage=`url("${serverProtocol}://${serverURL.replace("server","assets")}/images/checkerboard.png")`),i&&(i.style.opacity="1"),settings.skin=""})),e.disconnect()}let _search,skinsGlobal,globalTab=1;function drawGallery(e=0,t=null){const n=document.querySelector("#skin-search");_search||(_search=n.addEventListener("input",(e=>{const t=e.target.value;drawGalleryHandler(skinsGlobal,globalTab,null,t)})));const i=document.querySelector("#gallery-header"),s=document.querySelector(".coins"),o=document.createElement("div");o.classList.add("coins"),o.classList.add("double"),o.innerHTML=s.innerHTML;o.querySelector(".plus").classList.add("double"),i.innerHTML="Skins",i.appendChild(o);fetch(`${`${serverProtocol}://${serverURL}`}/skins/${uData.id||null}`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}}).then((e=>e.json())).then((n=>{skinsGlobal=n.body,drawGalleryHandler(n.body,e,t)})).catch((e=>{console.error(e)}))}window.changeTab=e=>{const t=e=>document.querySelector(`#${e}`);for(let n=1;n<=3;n++)if(n===e)switch(t(`btn-tab${n}`).classList.add("tab-active"),e){case 1:globalTab=1,t("skins-premium").classList.remove("hide"),t("skins-level").classList.add("hide"),t("skins-owned").classList.add("hide");break;case 2:globalTab=2,t("skins-level").classList.remove("hide"),t("skins-premium").classList.add("hide"),t("skins-owned").classList.add("hide");break;case 3:globalTab=3,t("skins-owned").classList.remove("hide"),t("skins-level").classList.add("hide"),t("skins-premium").classList.add("hide")}else t(`btn-tab${n}`).classList.remove("tab-active")},window.addSkin=(e,t,n)=>{if(void 0===uData.id)return void byId("needtobeloggined").show(1);let i={};i.skin=e,i.addSkin=1,updateUserData(uData.token,i,(()=>{drawGallery(3,e)}))},window.delSkin=(e,t)=>{let n={};n.skin=e,n.deleteSkin=1,updateUserData(uData.token,n,(()=>{drawGallery(3)}))};let searchOut="hfhjksa79879";function drawGalleryHandler(e,t,n=null,i=searchOut){i===searchOut&&(document.querySelector("#skin-search").value="");const s=`${serverProtocol}://${serverURL}`,o={free:"",level:"",premium:"",owned:""};let a=e.skins.sort(((e,t)=>e.cost-t.cost));a=a.sort(((e,t)=>e.level-t.level));for(let t=0;a[t];t++){const h=a[t],d=`${h.category}/${h.name}`;if(e.lastSkinUsed[0]==h._id){var r=document.getElementById("avatar");r&&(r.src=`${serverProtocol}://${serverURL}/skin/${h.category}/${h.name}`);var l=document.getElementById("js-skin-select-icon"),c=document.getElementById("js-skin-select-icon-text");l&&(l.style.backgroundImage=`url("${serverProtocol}://${serverURL}/skin/${h.category}/${h.name}")`),c&&(c.style.opacity="0"),settings.skin=`/skin/${d}`.replace(/^\/skin\//,"").replace(/^free\//,"1%").replace(/^level\//,"2%").replace(/^premium\//,"3%").replace(".png","")}const u=(e,t,n=null)=>{let i=`onclick="changeSkin('/skin/${d}', '${h._id}')"`,o="",a="",r="",l=`onclick="addSkin('${h._id}', '${h.category}', '${h.cost}')"`;h._id,h.category;switch(e){case"free":o=`<div id="${h._id}" ${l} class="button-success">Free</div>`,"owned"===t&&(o=`<div id="${h._id}" ${i} class="button-success">use</div>`);break;case"level":(!uData.id||uData.level<h.level)&&(r="button-disable",l="",i="",a="skin-disable"),o=`<div id="${h._id}" ${l} class="button-success ${r}">${h.level} level</div>`,"owned"===t&&(o=`<div id="${h._id}" ${i} class="button-success">use</div>`);break;case"premium":(!uData.id||uData.gold<h.cost)&&(r="button-disable",l="",a="skin-disable"),"owned"!==t&&(i=""),o=`<div id="${h._id}" ${l} class="button-success ${r}">${h.cost}\n                <img class="coin" alt="" src="https://sigmally.com/assets/images/icon/coin.svg"></div>`,"owned"===t&&(a="",o=`<div id="${h._id}" ${i} class="button-success">use</div>`)}let c="",u="";return n===h._id&&(c="new",u="new-action"),`\n        <li class="skin ${c}">\n        <div class="skin-image">\n          <img ${i} class="circular ${a}" src="${s}/skin/${d}">\n        </div>\n        <div class="skin-action">\n          <h4 class="skinName">${d.replace(/^\w+\//,"").replace(".png","")}</h4>\n          ${o}\n        </div>\n        </li>\n      `},g=(e,t=null,n=null)=>i===searchOut||-1!==h.name.toUpperCase().indexOf(i.toUpperCase())?u(e,t,n):"";if(-1===e.ownedSkins.indexOf(h._id))switch(h.category){case"free":o.free+=g("free");break;case"level":o.level+=g("level");break;case"premium":o.premium+=g("premium")}else o.owned+=g(h.category,"owned",n)}const h=document.createElement("div"),d=`\n    <ul id="skins-premium" class="skins-ul">${o.free}${o.premium}</ul>\n    <ul id="skins-level" class="skins-ul hide">${o.level}</ul>\n    <ul id="skins-owned" class="skins-ul hide">${o.owned}</ul>\n  `;h.innerHTML=d;const u=document.querySelector("#gallery-tabs-content");u&&(u.innerHTML="",u.appendChild(h)),0!==t&&changeTab(t)}function getTopUsers(){fetch(`${serverProtocol}://${serverURL}`+"/topusers",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{document.getElementsByClassName("top-users__list")[0].innerHTML="";for(var t=0;t<e.body.topUsers.length;t++)document.getElementsByClassName("top-users__list")[0].innerHTML+="<tr><td>"+(t+1)+"</td><td>"+e.body.topUsers[t].fullName+'</td><td align="center">'+e.body.topUsers[t].exp+"</td></tr>"})).catch((e=>{console.error(e)}))}const getServersStats=async()=>{const e=["US-1","US-2","Europe-1"];await Promise.all(["u0.sigmally.com","u2.sigmally.com","u1.sigmally.com"].map((async(t,n)=>{const i=`${serverProtocol}://${t}`;try{const s=await fetch(i+"/server/serversstats",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(200!==s.status)return void console.error(`Failed to fetch server stats from ${e[n]} (${s.status}: ${s.statusText})`);const o=await s.json();document.getElementById("option_"+n).innerHTML=e[n]+" "+o.body.serverstats.players_current+"/"+o.body.serverstats.players_max,players[t]=o.body.serverstats}catch(t){console.error(`Failed to fetch server stats from ${e[n]}`,t)}}))),setTimeout(getServersStats,3e4)};function Share(e){"fb"==e&&window.open("http://www.facebook.com/sharer.php?u=https://sigmally.com&quote=Play+to+Sigmally!%20Highest%20Mass%20"+document.getElementById("highest_mass").innerHTML+"%20Top%20Position%20"+document.getElementById("top_leaderboard_position").innerHTML+"%20Time%20Alive%20"+document.getElementById("time_alive").innerHTML+"%20Food%20Eaten%20"+document.getElementById("food_eaten").innerHTML,"pagename","resizable"),"tw"==e&&window.open("https://twitter.com/intent/tweet?text=Play%20To%20sigmally.com%20Highest%20Mass%20"+document.getElementById("highest_mass").innerHTML+"%20Top%20Position%20"+document.getElementById("top_leaderboard_position").innerHTML+"%20Time%20Alive%20"+document.getElementById("time_alive").innerHTML+"%20Food%20Eaten%20"+document.getElementById("food_eaten").innerHTML,"pagename","resizable")}getServersStats(),window.loginIfNoUser=()=>{if(void 0!==uData.id);else{var e=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});document.getElementById("signInBtn").dispatchEvent(e)}};